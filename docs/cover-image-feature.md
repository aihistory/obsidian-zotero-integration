# 封面图片功能

## 概述

obsidian-zotero-integration 插件现在支持从 obsidian-douban 项目导入的封面图片功能。这个功能允许用户在导入 Zotero 数据时自动下载和处理封面图片。

## 功能特性

### 1. 封面图片下载
- 自动从 Zotero 项目中提取封面图片
- 支持多种图片格式（JPG、PNG、GIF、BMP、WebP）
- 智能识别图片类型的附件

### 2. 本地保存
- 将封面图片保存到指定的本地文件夹
- 支持自定义附件存放路径
- 自动创建文件夹结构

### 3. 图床上传
- 支持 PicGo 图床服务
- 自动上传封面图片到图床
- 获取图床 URL 用于 Markdown 引用

### 4. 高清封面
- 支持下载高清版本的封面图片
- 自动尝试获取更高质量的图片
- 降级到普通质量作为备选方案

## 设置选项

### 基本设置

1. **保存图片附件**
   - 启用/禁用封面图片下载功能
   - 默认：启用

2. **附件存放位置**
   - 设置本地保存封面图片的文件夹路径
   - 支持模板变量，如：`{{myType}}/attachments`
   - 默认：`assets`

3. **保存高清封面**
   - 启用/禁用高清封面下载
   - 需要登录相关服务才能生效
   - 默认：启用

### 图床设置

1. **使用附件图床**
   - 启用/禁用图床上传功能
   - 默认：禁用

2. **选择图床类型**
   - 目前支持 PicGo
   - 默认：PicGo

3. **PicGo上传Url**
   - 设置 PicGo 服务的上传地址
   - 默认：`http://127.0.0.1:36677/upload`

## 使用方法

### 1. 配置设置
1. 打开 Obsidian 设置
2. 进入 "Zotero Integration" 插件设置
3. 找到 "封面图片设置" 部分
4. 根据需要配置相关选项

### 2. 导入数据
1. 使用插件的导入功能
2. 选择要导入的 Zotero 项目
3. 插件会自动处理封面图片
4. 封面图片会显示在生成的 Markdown 文件中

### 3. 图床使用
1. 安装并启动 PicGo 软件
2. 在插件设置中启用图床功能
3. 配置正确的 PicGo 上传地址
4. 导入数据时封面会自动上传到图床

## 文件结构

```
assets/
├── book/
│   └── citekey_book_title_cover.jpg
├── article/
│   └── citekey_article_title_cover.jpg
└── ...
```

## 技术实现

### 核心组件

1. **ImageHandler** (`src/utils/ImageHandler.ts`)
   - 处理图片下载和上传
   - 管理 HTTP 请求
   - 处理剪贴板操作

2. **CoverImageService** (`src/services/CoverImageService.ts`)
   - 封面图片处理服务
   - 提取封面 URL
   - 生成文件名和路径

3. **CoverImageSettings** (`src/settings/CoverImageSettings.tsx`)
   - 设置界面组件
   - 用户配置管理

### 数据流

1. **导出触发** → 检查封面设置
2. **提取封面URL** → 从 Zotero 项目中识别图片
3. **处理图片** → 下载到本地或上传到图床
4. **生成Markdown** → 在文档中插入封面图片引用

## 注意事项

1. **网络连接**
   - 封面下载需要网络连接
   - 某些图片可能需要特定的请求头

2. **存储空间**
   - 本地保存会占用存储空间
   - 建议定期清理不需要的封面图片

3. **图床服务**
   - 需要确保 PicGo 服务正常运行
   - 检查网络连接和防火墙设置

4. **文件权限**
   - 确保 Obsidian 有写入文件的权限
   - 检查文件夹创建权限

## 故障排除

### 常见问题

1. **封面下载失败**
   - 检查网络连接
   - 验证图片 URL 是否有效
   - 查看控制台错误信息

2. **图床上传失败**
   - 确认 PicGo 服务已启动
   - 检查上传地址配置
   - 验证网络连接

3. **文件保存失败**
   - 检查文件夹权限
   - 确认磁盘空间充足
   - 验证文件路径有效性

### 调试信息

启用调试模式可以查看详细的处理日志：
- 图片下载状态
- 图床连接状态
- 文件保存结果

## 更新日志

### v1.0.0
- 初始版本
- 支持基本的封面图片下载
- 支持 PicGo 图床上传
- 支持高清封面下载
- 完整的设置界面
